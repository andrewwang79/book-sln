# 销售设计

## 业务

* 一个商品一般最多两种规格。
* 支持商户申请新开品牌，查看申请进度。
* 一个商品同一时间只能属于一种销售类型(常规/秒杀/团购/优惠券)。已销售的商品不能修改本类型
* 商品不需要审核，上架时间到了自动上架
* 购物车有多个商户，多种类型的商品。
* 用户不登陆情况下，也可以使用购物车。

## 模块

### 属性方案

属性：描述属性，规格。
  * 描述属性：CPU型号（inter i5），电池容量（5000mA），质保期（3年）
  * 规格：颜色（黑色，白色），内存（4G,8G），屏幕尺寸(13寸，15寸)。

属性名和属性值：
  * 支持父属性，即属性名之间有级联关系。如品牌下的型号列表
  * 支持：单选，多选，文本，必选, 品牌
  * 品牌是个属性。举例:手机是个属性名。华为，小米，魅族是属性值。

实例说明：
  * 叶子类目及级联关系
    * 属性-品牌(PB)：属性名是品牌(PNB)，属性值是海飞丝(PVB1)，飘柔(PVB2)等
    * 属性-型号(PM)：属性名的父属性结果是PNB+PVB1(定义到父级属性，是品牌海飞丝)；属性名是型号(PNM)，属性值是清爽型(PNM1)，去油型(PNM2)等。
  * 商品的关系属性
    * PB的属性结果(海飞丝)：PNB + PVB1
    * PM的属性结果(海飞丝清爽型)：PNM + PNM1

### 类目方案

* 类目：一类商品的统称。比如：手机，电脑，水果，食品。
* 属性名关联类目，即一个属性名只能属于一个类目
* 自动继承父类目的属性

### 产品方案

主要用于商品快速创建的默认值：如商品标题等通用信息，属性结果默认值(类目属性结果，属性表内的产品属性结果)。

### 商品（Item,ItemSpec,ItemSku）方案

* 属性结果同时存储在两个地方：关联属性表，业务表(产品Product/商品Item/ItemSku)的属性结果字段(json)。
* 业务表(商品Item)：
  * 属性结果字段格式：属性名id1:属性值id11,属性值id12;属性名id2:属性值id21,属性值id22。例子："颜色:红,绿;尺寸:13寸，15寸"
* 业务表(商品规格ItemSpec)：
  * 属性结果字段格式：属性名Id1：属性名id1:属性值id11;属性名id2:属性值id21。例子："颜色:红;尺寸:13寸"
* 业务表(ItemSku)：
  * 每一种规格商品的销售数量，销售价格等
* 关联属性表PropRelation：
  * 记录业务表创建时的属性结果，其实和业务表上的是一样的。只是为了更便于查询统计。
  * 通过“关联属性表”关联，定义一个具象的商品。

### 商品上下架方案

* 上架：可销售(有库存)就可以操作
* 下架：先退出参加的活动，方可下架

### 购物车方案

* 购物车商品跟用户关联。
* 购物车商品售罄或下架，该购物车项数据失效。
* 购物车有商品价格，数量，活动信息，商户信息。
* 同一商家，商品基于活动分组。
* 卡券类商品，不支持加入购物车，可直接购买（京东，淘宝也这样做），有订单。
* 用户不登陆，也可以使用购物车功能。登录之后，两个购物车合并。

#### 流程

1. 商品加入购物车:
    ``````
    if(购物车中有该商品数据){
        更新购物车;
        自动匹配相关的营销活动；    
    }else{
        新建购物车(基于商家和商品类型(实物，卡券)分类);
    }
    ``````
1. 购物车更新：
  * 更新商品数据
  * 更新活动数据
1. 从购物车中删除：
  * 物理删除。
  * 返回给前端该模块（购物车所在分类）的全部数据
1. 从购物车下单：
  * 可一次提交多个购物车模块。
  * 订单结构和购物车模块结构保持一致。
  * 下单完成，删除购物车数据。

#### 购物车结构
``````
Cart
{
  "cartId": "111",
  "userId": null, // 匿名用户是null
  "shopCarts": [
    {
      "shopName": "智橙官方旗舰店",
      "shopId": "123",
      "activityList": [
        {
          "id": "1",
          "title": "满减活动",
          "type": "fullCut",
          "usePromo": "满100减50",
          "usePromoDiscount": 50,
          "promos": [
            "满100减50",
            "满200减120"
          ]
        },
        {
          "id": "2",
          "title": "满减活动",
          "type": "fullCut",
          "usePromo": "满100减50",
          "usePromoDiscount": 50,
          "promos": [
            "满100减50",
            "满300减120"
          ]
        }
      ],
      "cartItemList": [
        {
          "cartItemId": "123",
          "itemName": "Audio Technica铁三角 ATH-CLR100 手机音乐运动入耳式耳机",
          "props": "型号: ATH-CLR100",
          "price": "1999.99",
          "coverPic"："",
          "pics"："",
          "discountPrice": "1599.99",
          "count": "2",
          "createTime": "2017-05-12 12:52:12",
          "activityId": "1",
          "min": "2", // null表示不限制
          "max": "10"
        },
        {
          "cartItemId": "124",
          "itemName": "Audio Technica铁三角 ATH-CLR100 手机音乐运动入耳式耳机",
          "props": "型号: ATH-CLR100",
          "price": "1999.99",
          "coverPic"："",
          "pics"："",
          "discountPrice": "1599.99",
          "count": "2",
          "createTime": "2017-05-12 12:52:12",
          "activityId": "2",
          "min": "2",
          "max": "10"
        }
      ]
    }
  ]
}

``````
