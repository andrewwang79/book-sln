# 方案
## 系统定义
1. 多商户SAAS
1. 多网点：商城/线下店，打通线上线下
1. 全渠道：京东/天猫等
1. 全配送：

## 概念
| 类型 | 功能 | 说明 |
| :----: | ---- | ---- |
| 人 | 会员 |  |
| 钱 | 网银，预付费卡等 |  |
| 物 | 商品 |  |
| 渠道 | 商城，网点 | 网点有收银系统和广告屏 |

## 系统
### 零售
1. [零售系统](#零售系统)：商城(微信，含线上线下)，中台，平台系统，网点管理手机版
1. 收银系统
1. 渠道对接：京东，天猫，美团外卖，饿了吗
1. 配送对接：对接了五大主流配送平台的一套众包配送体系，99%的一小时达率，五成30分钟内送达，整体平均送达时间29分钟

### ERP
1. 供应链
1. 财务

## 设计
1. 所有涉及到自提的，都采用提货码模式。提货码存在于订单
1. 所有涉及到钱的(如优惠券，支付码)二维码，都采用定期(如一分钟)自动失效的凭证机制
1. 图库可用于商品，活动等。支持2级分类。回收站15天内自动删除
1. 销售主体(如商品，订单)的结构
	1. 所有结构统一，但字段不一定都使用
	1. 商品销售渠道字段区分是网点还是商城，如网点商品的类目是null
1. 零售系统和进销存系统关系：前者有商品，规格。后者有产品，SKU。前者通过规格关联后者
1. 网店和网点的配送是一个模型：快递，自提，配送

## 角色
| 结构 | 角色 | 职责 |
| :----: | ---- | ---- |
| 总部 | 运营 | 上商品 |
| 总部 | 采购 | 采购商品 |
| 总部 | 财务 |  |
| 网点 | 店长 | 发起采购申请，入库 |
| 网点 | 店员 |  |

## 模块
### 商品

| 项 | 分类 | 类目 | 属性 | 规格 | 商户权力 |
| :----: | ---- | ---- |
| 网点 | 自定义 | 无 | 自定义 | 自定义 | 美团方案 |
| 商户商城 | 自定义 | 预置(1级) | 无 | 属性名类目预置 + 属性值自定义 | 放开为主，适当控制 |

### 网点
1. 关联：收银终端，用户，订单

# 零售系统
## 功能
### 用户
1. 用户标签
1. 注册渠道

### 网点
1. 网点分类独立设置
1. 独立商品，库存，价格
1. 自提，配送
1. 配送范围&起送价-按网点设置自定义多边形配送范围和起送价
1. 发货时间可设置
1. 支持外部渠道订单，如美团外卖

### 商城
1. 会员价(三级)
1. 商品可以普通上架，也可以抢购模式上架
1. 普通商品和抢购商品可以直接购买，也可以进购物车
1. 团购是独立系统，不仅购物车
1. 商品快照
1. 虚拟商品发货方法：信息人工/自动对接(外部合作方的券)，核销(系统内部券)
1. 商品定时上下架

### 营销
1. 优惠券，积分方案
1. 优惠券，满减等，如何复用

## 方案
### 高并发下单
1. 采用MQ接收下单，削峰填谷，MQ异步转同步返回

### 调整库存
每个商品一个redis

1. 同步锁写redis，同步更新DB
1. 同步锁写redis，异步更新DB
1. 读redis够库存则下单成功，后续通过MQ更新库存(redis和DB)。在库存不多的情况下有少量超卖可能，可以在大库存情况下采用
1. 数据版本号不一样则撤销【不适用高并发】

## 流程

### 上货
1. 网点
	1. 商城相当于一个网点
	1. 总部发布商品
	1. 网点商品入库(SKU)
	1. 网点上架商品(选产品，设置售价，可售量由库存自动带出)

1. 商城
	1. 上商品(不管库存(从可售量无法获知库存量)。如有需要，可对接WMS，设置可售量)

### 商品发布和出入库
* 网店是直接发布商品(同时一起做库存)
* 网点是总部先发布商品，再进网点库存

## 表结构
### 商品
* 结构：商品编码，外部编号，是否统一价

### 规格
* 结构：商品号，外部编号，名称，条形码，价格

### 网点商品
* 结构：商品号，描述

### 网点商品规格
* 结构：规格编号，价格，SKU(货号，仓库位置)，库存量

# 收银系统
## 功能
1. 收银设备(编号，类型，供应商)归属网点。销售支付等信息关联到收银设备

# 供应链
* 商城业态可以自定义库存量，也可以启用本系统(对接进销存系统)进行库存管理
* 所有商品的出入库都在本系统操作
